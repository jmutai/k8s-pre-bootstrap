---
- name: Pre-reqs setup task
  import_tasks: pre_setup.yml
  when: pre_setup
  tags: pre_setup

- name: Configure firewall 2
  import_tasks: "{{ item }}"
  with_first_found:
    - "configure_firewall2_{{ os_distrib_version }}.yml"
    - "configure_firewall2_{{ os_family_version }}.yml"
    - "configure_firewall2_{{ os_distrib }}.yml"
    - "configure_firewall2_{{ os_family }}.yml"
  when: firewall and (not remove_firewall)
  tags: firewall

- name: Disable swap
  import_tasks: disable_swap.yml
  when: dis_swap
  tags: dis_swap

- name: Load required kernel modules and sysctl configs
  import_tasks: load_kernel_modules_sysctl.yml
  when: kernel_mod
  tags: kernel_mod

- name: Configure /etc/hosts file on each node
  import_tasks: configure_etc_hosts_file.yml
  when: etc_hosts
  tags: etc_hosts

- name: Configure docker
  import_tasks: "{{ item }}"
  with_first_found:
    - "setup_{{ container_runtime }}_{{ os_distrib_version }}.yml"
    - "setup_{{ container_runtime }}_{{ os_family_version }}.yml"
    - "setup_{{ container_runtime }}_{{ os_distrib }}.yml"
    - "setup_{{ container_runtime }}_{{ os_family }}.yml"
  when: container
  tags: container

# - name: Add k8s repo to system
#   import_tasks: "{{ item }}"
#   with_first_found:
#     - "k8s_repo_{{ os_distrib_version }}.yml"
#     - "k8s_repo_{{ os_family_version }}.yml"
#     - "k8s_repo_{{ os_distrib }}.yml"
#     - "k8s_repo_{{ os_family }}.yml"
#   when: k8s_repo
#   tags: k8s_repo

- name: Install k8s packages
  import_tasks: install_k8s_packages.yml
  with_first_found:
    - "install_k8s_packages_{{ os_distrib_version }}.yml"
    - "install_k8s_packages_{{ os_family_version }}.yml"
    - "k8s_repo_{{ os_distrib }}.yml"
    - "k8s_repo_{{ os_family }}.yml"
  when: k8s_pack
  tags: k8s_pack
