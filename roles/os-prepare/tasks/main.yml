---
- name: Add the OS specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "config_pm_proxy_{{ os_distrib_version }}.yml"
    - "config_pm_proxy_{{ os_family_version }}.yml"
    - "config_pm_proxy_{{ os_distrib }}.yml"
    - "config_pm_proxy_{{ os_family }}.yml"
  tags: set_proxy

- name: Configure OS network
  import_tasks: config_os_network.yml
  when: config_os_network
  tags: config_net

- name: Configure package manager
  import_tasks: "{{ item }}"
  with_first_found:
    - "config_pm_{{ os_distrib_version }}.yml"
    - "config_pm_{{ os_family_version }}.yml"
    - "config_pm_{{ os_distrib }}.yml"
    - "config_pm_{{ os_family }}.yml"
  when: config_pm
  tags: config_pm

- name: Config OS proxy
  import_tasks: config_os_proxy.yml
  when: setup_proxy
  tags: set_proxy

- name: Config package manager proxy
  import_tasks: "{{ item }}"
  with_first_found:
    - "config_pm_proxy_{{ os_distrib_version }}.yml"
    - "config_pm_proxy_{{ os_family_version }}.yml"
    - "config_pm_proxy_{{ os_distrib }}.yml"
    - "config_pm_proxy_{{ os_family }}.yml"
  when: setup_proxy
  tags: set_proxy

### REBOOT for network settings
- name: Reboot servers
  import_tasks: reboot_servers.yml
  when: reboot
  tags: reboot

- name: Upgrade OS
  import_tasks: "{{ item }}"
  with_first_found:
  - "upgrade_os_{{ os_distrib_version }}.yml"
  - "upgrade_os_{{ os_family_version }}.yml"
  - "upgrade_os_{{ os_distrib }}.yml"
  - "upgrade_os_{{ os_family }}.yml"
  when: upgrade_os
  tags: upgrade_os

- name: Install packages
  import_tasks: install_packages.yml
  when: install_pack
  tags: install_pack

- name: Install time sync client
  import_tasks: "{{ item }}"
  with_first_found:
    - "install_time_sync_client_{{ os_distrib_version }}.yml"
    - "install_time_sync_client_{{ os_family_version }}.yml"
    - "install_time_sync_client_{{ os_distrib }}.yml"
    - "install_time_sync_client_{{ os_family }}.yml"
  when: time_sync
  tags: time_sync

### REBOOT for upgrade OS
- name: Reboot servers
  import_tasks: reboot_servers.yml
  when: reboot
  tags: reboot
