---
- name: PRE tasks
  import_tasks: "{{ item }}"
  with_first_found:
    - "pre_tasks_{{ os_distrib_version }}.yml"
    - "pre_tasks_{{ os_family_version }}.yml"
    - "pre_tasks_{{ os_distrib }}.yml"
    - "pre_tasks_{{ os_family }}.yml"
  when: pre_tasks
  tags: pre_tasks

- name: Configure OS network
  import_tasks: config_os_network.yml
  when: config_os_network
  tags: config_net

- name: Configure package manager
  import_tasks: "{{ item }}"
  with_first_found:
    - "config_pm_{{ os_distrib_version }}.yml"
    - "config_pm_{{ os_family_version }}.yml"
    - "config_pm_{{ os_distrib }}.yml"
    - "config_pm_{{ os_family }}.yml"
  when: config_pm
  tags: config_pm

- name: Config OS proxy
  import_tasks: config_os_proxy.yml
  when: setup_proxy
  tags: set_proxy

- name: Config package manager proxy
  import_tasks: "{{ item }}"
  with_first_found:
    - "config_pm_proxy_{{ os_distrib_version }}.yml"
    - "config_pm_proxy_{{ os_family_version }}.yml"
    - "config_pm_proxy_{{ os_distrib }}.yml"
    - "config_pm_proxy_{{ os_family }}.yml"
  when: setup_proxy
  tags: set_proxy

- name: Remove firewall
  import_tasks: "{{ item }}"
  with_first_found:
    - "remove_firewall_{{ os_distrib_version }}.yml"
    - "remove_firewall_{{ os_family_version }}.yml"
    - "remove_firewall_{{ os_distrib }}.yml"
    - "remove_firewall_{{ os_family }}.yml"
  when: remove_firewall
  tags: remove_firewall

- name: Install and configure firewall 1
  import_tasks: "{{ item }}"
  with_first_found:
    - "install_firewall_{{ os_distrib_version }}.yml"
    - "install_firewall_{{ os_family_version }}.yml"
    - "install_firewall_{{ os_distrib }}.yml"
    - "install_firewall_{{ os_family }}.yml"
  when: firewall and (not remove_firewall)
  tags: firewall

- name: Config Access Control system (SELinux, AppArmor, parsec)
  import_tasks: "{{ item }}"
  with_first_found:
    - "config_ac_{{ os_distrib_version }}.yml"
    - "config_ac_{{ os_family_version }}.yml"
    - "config_ac_{{ os_distrib }}.yml"
    - "config_ac_{{ os_family }}.yml"
  when: config_ac
  tags: config_ac

### REBOOT for network settings
- name: Reboot servers
  import_tasks: reboot_servers.yml
  when: reboot
  tags: reboot

- name: Upgrade OS
  import_tasks: "{{ item }}"
  with_first_found:
  - "upgrade_os_{{ os_distrib_version }}.yml"
  - "upgrade_os_{{ os_family_version }}.yml"
  - "upgrade_os_{{ os_distrib }}.yml"
  - "upgrade_os_{{ os_family }}.yml"
  when: upgrade_os
  tags: upgrade_os

- name: Install packages
  import_tasks: install_packages.yml
  when: install_pack
  tags: install_pack

- name: Install time sync client
  import_tasks: "{{ item }}"
  with_first_found:
    - "configure_timezone_ntp_{{ os_distrib_version }}.yml"
    - "configure_timezone_ntp_{{ os_family_version }}.yml"
    - "configure_timezone_ntp_{{ os_distrib }}.yml"
    - "configure_timezone_ntp_{{ os_family }}.yml"
  when: configure_timezone_ntp
  tags: config_ntp

### REBOOT for upgrade OS
- name: Reboot servers
  import_tasks: reboot_servers.yml
  when: reboot
  tags: reboot
